# 超级玛丽第一关
用C语言和SDL2实现的经典超级玛丽游戏第一关

## 🎯 项目最新更新
**最新更改（2024.12.30）**：
- **角色动画系统** 🆕：马里奥现在拥有完整的动画系统！
- **多帧动画播放**：静止时播放idle动画（4帧），移动时播放run动画（16帧）
- **智能动画切换**：根据移动状态自动切换动画，固定帧率播放
- **水平翻转支持**：左右移动时动画自动反向，真实的方向感
- **高性能渲染**：使用SDL2_RenderCopyEx实现硬件加速的纹理翻转

**角色动画详情**：
- 🏃 **跑步动画**：16帧流畅跑步动作 (`assets/sprites/player/player_run1-16.png`)
- 🧍 **静止动画**：4帧呼吸动作 (`assets/sprites/player/player_idle1-4.png`)
- ⚡ **自动播放**：每0.1秒切换一帧，循环播放
- 🔄 **方向感知**：向左移动时动画水平翻转

**之前更改（地图纹理化）**：
- **地图纹理化** 🆕：引入PNG纹理系统，地图方块现在使用真实素材
- **智能方块分类**：自动根据位置区分草地（地表）和泥土（地下）方块
- **纹理加载系统**：重新集成SDL2_image，支持PNG图片加载和渲染
- **视觉体验升级**：从纯色矩形升级到精美的像素艺术纹理

**地图素材系统**：
- 🌱 **草地纹理**：`assets/sprites/world/grass.png` - 用于地表方块
- 🟫 **泥土纹理**：`assets/sprites/world/mud.png` - 用于地下方块  
- ⚡ **自动识别**：系统根据方块上方是否有空气自动选择纹理类型

**之前更改（敌人系统地图化）**：
- **敌人系统地图化** 🆕：将敌人位置整合到地图数据中，可在地图中直接编辑敌人位置
- **地图编辑简化**：使用'E'字符在地图中标记敌人位置，系统自动创建敌人对象
- **关卡设计友好**：敌人位置可视化，便于设计和调整关卡布局
- **系统优化**：移除硬编码的敌人位置，采用数据驱动的敌人生成

**之前更改（2024.06.30）**：
- **完全移除sprite系统**：删除所有图片素材相关代码，使用纯SDL矩形绘制
- **格子大小调整**：从32x32调整为16x16，更精细的游戏体验
- **角色尺寸优化**：马里奥改为15x20像素，更符合角色比例
- **修复渲染卡顿**：优化浮点数渲染计算，消除角色移动时的闪回现象
- **敌人系统修复**：修正敌人消失问题，确保敌人正常显示和运行
- **代码大幅简化**：可执行文件约54KB，运行流畅稳定

## 游戏功能

### 基础功能
- 马里奥角色移动（左右键）和跳跃（空格键）
- 重力物理系统和碰撞检测
- 卷轴式摄像机跟随
- 奖励方块系统（可撞击但不再变大）

### 敌人系统 🆕
- **栗子小子（Goomba）敌人**：棕色方块敌人
- **地图化配置** ✨：敌人位置通过地图数据管理，在`scripts/map.c`中编辑
- **智能移动**：敌人会在平台上左右移动，遇墙转向，避免掉下悬崖
- **踩踏机制**：从上方跳到敌人身上可以消灭敌人，马里奥会弹跳
- **伤害系统**：侧面碰撞会使马里奥受伤并失去生命
- **无敌时间**：受伤后有2秒无敌时间，期间马里奥会闪烁
- **生命系统**：马里奥有3条生命，生命用完游戏结束

#### 地图编辑字符说明：
```
'G' = 草地（地表，使用grass.png）
'M' = 泥土（地下，使用mud.png）
'#' = 普通砖块（可选，棕色矩形）
' ' = 空地（透明）
'?' = 奖励方块（黄色）
'E' = 敌人位置（游戏启动时自动转换为栗子小子敌人）
'T' = 通关方块（绿色终点，触碰即通关）
```
要添加敌人，只需在地图数据中放置'E'字符即可！
要设置终点，将'T'放在想要的通关位置！

### 视觉系统 ✨
- **混合渲染模式**：地图使用PNG纹理，角色使用动画纹理，其他元素使用彩色矩形
  - 🌱 草地方块：使用grass.png纹理（16x16像素）
  - 🟫 泥土方块：使用mud.png纹理（16x16像素）
  - 🏃 马里奥角色：使用动画纹理系统（15x20像素）
    - 静止：4帧idle动画循环播放
    - 移动：16帧run动画流畅播放
    - 自动水平翻转，真实方向感
  - 棕色：栗子小子敌人（16x16）
  - 黄色：问号奖励方块（16x16）
  - 绿色：通关目标方块（16x16）
  - 天蓝色：背景
- **智能纹理选择**：系统自动根据方块位置选择草地或泥土纹理
- **动画播放系统**：角色动画以固定0.1秒/帧的速度播放，平滑流畅
- **平滑渲染**：优化浮点数计算，消除移动卡顿和闪回
- **无敌闪烁**：受伤时马里奥会闪烁显示
- **高性能混合渲染**：关键地形和角色使用纹理，UI元素使用几何绘制

### 操作方式
- **左/右方向键**：移动马里奥
- **空格键**：跳跃
- **ESC键**：退出游戏

### 游戏目标
- 避开或踩踏敌人
- 撞击奖励方块
- 尽可能向右前进

## 编译和运行

### 依赖要求
- **SDL2核心库**：`brew install sdl2`
- **SDL2_image库**：`brew install sdl2_image` （用于PNG纹理加载）

### 快速开始
```bash
# 1. 安装依赖
brew install sdl2 sdl2_image

# 2. 编译游戏（三种方式任选一种）

# 方式1：使用编译脚本（推荐）
./build.sh

# 方式2：VS Code编译
# 按 Cmd+Shift+P -> "Tasks: Run Build Task"

# 方式3：手动编译
gcc -I/opt/homebrew/include/SDL2 -D_THREAD_SAFE -L/opt/homebrew/lib scripts/*.c -o knight_game -lSDL2

# 3. 运行游戏
./knight_game
```

## 📁 项目结构
```
小学期作业/
├── scripts/               # 所有源代码文件
│   ├── main.c             # 主程序和游戏循环
│   ├── knight.c/h         # 骑士角色逻辑（简化版）
│   ├── enemy.c/h          # 敌人系统
│   ├── map.c/h            # 地图数据
│   ├── render.c/h         # SDL2渲染（纯矩形绘制）
│   ├── camera.c/h         # 摄像机系统
│   ├── blocks.c/h         # 奖励方块系统
│   └── input.c/h          # 输入处理
├── .vscode/
│   └── tasks.json         # VS Code 编译配置
├── knight_game            # 编译后的可执行文件（60KB）
└── README.md              # 本文件
```

## 🚀 技术特点
- **完整动画系统**：角色拥有多状态动画，固定帧率播放，支持水平翻转
- **混合渲染架构**：地形使用PNG纹理，角色使用动画纹理，游戏对象使用几何绘制
- **智能状态管理**：根据移动状态自动切换idle/run动画，无缝过渡
- **硬件加速翻转**：使用SDL2_RenderCopyEx实现高性能纹理翻转
- **智能纹理系统**：自动根据方块周围环境选择草地或泥土纹理
- **高效素材管理**：SDL2_image纹理加载与缓存，优化内存使用
- **16x16精细格子**：比原来的32x32更精细的游戏体验
- **优化的角色比例**：马里奥15x20像素，更真实的人物比例
- **无卡顿移动**：修复渲染算法，消除角色移动闪回问题
- **数据驱动设计**：敌人位置、地图布局完全由数据文件控制
- **代码模块化**：清晰的功能分离，易于维护和扩展

## 📝 学习收获
- 掌握了SDL2图形编程基础
- 实现了2D游戏物理系统
- 学会了模块化程序设计
- 理解了游戏循环和状态管理
- 实践了碰撞检测算法
- 体验了代码简化和优化的过程
- 学会了在功能和复杂度之间平衡
